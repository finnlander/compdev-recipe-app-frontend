<div>
  <h2>{{ mode | titlecase }} recipe</h2>
  <form (ngSubmit)="onSubmit()" [formGroup]="form">
    <!-- recipe fields -->
    <div class="form-group">
      <label for="name">Name</label>
      <input class="form-control" type="text" formControlName="name" />
    </div>
    <div class="form-group">
      <label for="description">Description</label>
      <textarea
        class="form-control"
        type="text"
        formControlName="description"
      ></textarea>
    </div>
    <div class="form-group">
      <label for="imageUrl">Image URL</label>
      <input
        type="url"
        class="form-control"
        placeholder="https://"
        formControlName="imageUrl"
        #imageUrl
      />
    </div>
    <div class="form-group">
      <img
        class="img-responsive shadowed"
        [src]="imageUrl.value"
        alt="[recipe image]"
      />
    </div>
    <hr />
    <!-- phases -->
    <div class="form-group">
      <h4>Cooking Phases</h4>

      <label class="inline-checkbox float-left" for="usePhases">
        <input type="checkbox" name="usePhases" formControlName="usePhases" />
        Divide recipe into phases
      </label>

      <ng-container *ngIf="usePhases">
        <div class="flex-wrapper">
          <div class="">
            <input
              class="form-control"
              type="text"
              formControlName="newPhaseName"
              placeholder="Phase name"
            />
          </div>
          <div class="">
            <button
              class="btn btn-primary"
              type="button"
              (click)="onAddPhase()"
              [disabled]="!canAddPhase()"
              title="Add new phase"
            >
              <fa-icon [icon]="iconAdd"></fa-icon>
              Add
            </button>
          </div>
        </div>
        <div class="gutter"></div>
        <ng-container *ngIf="phases.length > 0" formArrayName="phases">
          <p>Phases:</p>
          <ul class="list-group phase-item-size">
            <li
              class="list-group-item"
              *ngFor="let phaseControl of phases.controls; let i = index"
            >
              <div class="flex-wrapper">
                <div class="flex-grow">{{ phaseControl.value }}</div>
                <div class="">
                  <button
                    type="button"
                    class="btn btn-xs btn-danger"
                    [disabled]="!canDeletePhase(phaseControl.value)"
                    [title]="
                      canDeletePhase(phaseControl.value)
                        ? 'Delete'
                        : '(phase is in use)'
                    "
                  >
                    <fa-icon
                      [icon]="iconDelete"
                      (click)="onDeletePhase(i)"
                    ></fa-icon>
                  </button>
                </div>
              </div>
            </li>
          </ul>
          <hr />
        </ng-container>
      </ng-container>
    </div>
    <!-- ingredients -->
    <div class="form-group">
      <h4>Ingredients</h4>
      <button class="btn btn-primary" type="button" (click)="onAddIngredient()">
        <fa-icon [icon]="iconAdd"></fa-icon>
        Add ingredient
      </button>
      <hr *ngIf="ingredientItems.length > 0" />
      <ng-container formArrayName="ingredientItems">
        <ng-container
          *ngFor="
            let ingredientControl of ingredientItems.controls;
            let i = index
          "
          [formGroup]="ingredientControl"
        >
          <div class="ingredient-row">
            <div class="vertical-label-box">
              <div class="vertical-label">Ingredient</div>
            </div>
            <div class="ingredient-content-wrapper">
              <!-- Ingredient -->
              <div class="ingredient-name">
                <label>
                  Name
                  <input
                    class="form-control input-item"
                    type="text"
                    formControlName="ingredientName"
                  />
                </label>
              </div>
              <div class="ingredient-amount">
                <label>
                  Amount
                  <input
                    class="form-control input-item"
                    type="number"
                    formControlName="amount"
                  />
                </label>
              </div>
              <div class="ingredient-unit">
                <label>
                  Unit
                  <select
                    class="form-control input-item"
                    formControlName="unit"
                  >
                    <option
                      [value]="unit.value"
                      *ngFor="let unit of RecipeUnit | keyvalue"
                    >
                      {{ unit.value }}
                    </option>
                  </select>
                </label>
              </div>
              <div class="ingredient-phase" *ngIf="usePhases">
                <label>
                  Phase
                  <select
                    class="form-control input-item"
                    formControlName="phase"
                  >
                    <option
                      [value]="phase"
                      *ngFor="let phase of form.value.phases; let i = index"
                    >
                      {{ phase }}
                    </option>
                  </select>
                </label>
              </div>
            </div>
            <div class="btn-delete">
              <button
                class="btn btn-danger btn-sm"
                type="button"
                (click)="onDeleteIngredient(i)"
              >
                <fa-icon [icon]="iconDelete"></fa-icon>
              </button>
            </div>
          </div>
        </ng-container>
      </ng-container>
    </div>
    <hr />

    <button class="btn btn-success" type="submit" [disabled]="!canSave()">
      Save
    </button>
    <button class="btn btn-secondary" type="button" (click)="onCancel()">
      Cancel
    </button>
  </form>
</div>
